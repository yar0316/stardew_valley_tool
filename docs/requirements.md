% Stardew Valley 便利ツール 要件定義（v0）

## 目的 / スコープ

- 目的: Stardew Valley のプレイ効率を上げる補助ツールを提供する。
- スコープ: オフラインで使えるスタンドアロンツールを基本とし、将来的にゲーム内データ連携（セーブ/SMAPI）を拡張可能にする。

## 対象ユーザー

- 効率良く金策・好感度上げ・コレクション埋めを進めたい一般プレイヤー
- 情報を日本語で参照したいユーザー

## 対応プラットフォーム（想定）

- v1: デスクトップ（Windows/macOS/Linux）のローカル実行 CLI/簡易GUI
- 以降: Web UI（ローカルホストで動作）を検討

---

## 必須機能（要求詳細）

1. 収益計算（作物のみ）

- 入力: 作物名、季節、種価格、成長日数、再収穫可否・間隔、収穫回数、肥料（任意）、農業スキル/特化（任意）
- 出力: 期間あたりの純利益/日、投資回収日、総収益、1タイル/1畑/任意面積換算
- 仕様:
  - v1はベース価格での概算（品質・肥料補正は任意設定）。
  - 再収穫作物は期間内での最大収穫回数を自動計算。
  - 雨/スプリンクラー/水やり失敗は考慮しない（v1）。

2. 作物の収穫計画

- 入力: 季節（春/夏/秋/冬）、開始日、終了日（または残日数）、温室の有無（任意）
- 出力: 指定期間内で最大利益が見込める作付け計画（作物・播種日・収穫日・回数）
- 仕様:
  - 各作物の成長日数・再収穫間隔・種価格を考慮して貪欲/全探索の簡易最適化を実施。
  - v1は単一作物の最適選択と単純な差し替え案（終盤差し込み用）を提示。

3. プレゼント探し

- 入力: 住人名、アイテム名（前方一致/候補サジェスト）
- 出力: その組み合わせの評価（大好き/好き/普通/嫌い/大嫌い）
- 付加機能: 住人→「大好き」/「好き」一覧、アイテム→誰が喜ぶかの逆引き

4. 魚の検索

- 入力: 魚名
- 出力: 季節、天気、出現時間帯、場所、備考（ウキ/トラベリングカート等）

5. バンドル早見

- 出力: 各バンドルの必要アイテム、カテゴリ、報酬
- 拡張: セーブ読込ができる場合、未達・達成済の差分表示

---

## ゲーム内データ参照の可否と方法

結論: 外部ツールからの参照は「セーブファイル読込」または「SMAPI（Mod）連携」で可能。リアルタイム値の取得はSMAPIが現実的。

- セーブファイル読込（推奨・非Mod）
  - 可能: はい。ゲーム終了時/就寝時の最新状態をXMLで保持。
  - 代表パス（例）:
    - Windows: `C:\\Users\\<User>\\AppData\\Roaming\\StardewValley\\Saves\\<SaveFolder>`
    - macOS: `~/Library/Application Support/StardewValley/Saves/<SaveFolder>`
    - Linux: `~/.config/StardewValley/Saves/<SaveFolder>`
  - 含まれる情報（例）: 日付・季節、所持金、交友度、博物館、バンドル進捗、所持品/収納、農地の作物状態 等
  - 制約: プレイ中のリアルタイム状態は不定（セーブ時点に依存）。

- SMAPI（Mod）連携（任意・拡張）
  - 可能: はい。SMAPI Modでゲームイベントにフックし、JSON出力やWebSocket等で外部に公開可能。
  - 利点: リアルタイムの天気/時間/位置/作物成長/住人予定などを扱える。
  - 制約: Mod導入が前提。配布/互換性の考慮が必要。

- その他
  - メモリスキャン等の手法は非推奨（安定性・安全性・規約面）。

提案（v1）: 非Modでのセーブ読込に対応し、可能な範囲で以下を自動入力/可視化。

- 現在の季節/日付の自動取得→収穫計画の初期値に反映
- バンドル進捗の可視化（未達アイテムの抽出）
- 住人の交友度に応じたプレゼント優先度ヒント（任意）

---

## マスタデータ（出典と取得方針）

- 出典: Stardew Valley Wiki 日本語版（<https://ja.stardewvalleywiki.com/Stardew_Valley_Wiki）>
- 取得方針:
  1) v1は整形済みの静的データ（JSON/CSV）をリポジトリに同梱（出典明記・差分管理）。
  2) 後続でMediaWiki API等からの自動取得スクリプトを追加し、ローカルキャッシュ更新を可能にする。
  3) ライセンス/帰属表記（クレジット）をドキュメント/アプリ内に明記。

---

## データ保存方式（提案）

- Option A: 内蔵JSON（推奨・v1）
  - 内容: 作物/種価格/成長/品質補正、住人→ギフト嗜好、魚→季節/天気/時間/場所、バンドル構成 等
  - 長所: オフライン即応、単純、差分管理が容易
  - 短所: 手動更新が必要（スクリプトで半自動化可）

- Option B: SQLite
  - 長所: 柔軟な検索、高度なクエリ
  - 短所: セットアップがやや重い、v1のスコープ過剰

- Option C: オンデマンド取得＋ローカルキャッシュ
  - 長所: いつでも最新
  - 短所: ネットワーク依存、Wiki構造変更に脆弱

推奨: v1は Option A（内蔵JSON）。将来的に B/C を併設可能な設計にする。

---

## データモデル（例・簡易）

```json
// crops.json（一部例）
{
  "パースニップ": {"season": ["春"], "seedPrice": 20, "daysToGrow": 4, "regrow": null, "sellPrice": 35},
  "ブルーベリー": {"season": ["夏"], "seedPrice": 80, "daysToGrow": 13, "regrow": 4, "sellPrice": 50}
}

// gifts.json（一部例）
{
  "アビゲイル": {"love": ["アメジスト", "パンプキン"], "like": ["クォーツ"], "neutral": ["エッグ"], "dislike": [], "hate": ["ゴミ"]}
}

// fish.json（一部例）
{
  "サーモン": {"season": ["秋"], "weather": ["晴れ", "雨"], "time": "6:00-19:00", "location": ["川"]}
}

// bundles.json（一部例）
{
  "工房（畜産）": {"items": ["ミルク", "ヤギミルク", "ウール", "大ミルク", "大ヤギミルク"]}
}
```

---

## アルゴリズム方針（要点）

- 収益計算: 期間 D に対し、非再収穫は floor((D - 成長日数 + 1) / 成長サイクル) を0/1で処理。再収穫は初回後 regrow 間隔で回数算出。
- 計画最適化: 基本は貪欲（最も高い 日次純利益/タイル を優先）、終了間際に短期作物へ差し替え評価。
- ギフト検索: 住人→アイテムの精確一致/カテゴリ一致を実装。別名/同義語はサジェスト対応。
- 魚検索: 正規化名から直接照会。別名は候補提示。
- バンドル: セーブ読み込み時は不足アイテムを差分計算。

---

## 非機能要件

- オフライン動作: 可能（内蔵JSON）
- パフォーマンス: 単一検索は100ms以内、計画計算は数百ms程度目安
- 国際化: 日本語データ優先、英名併記フィールドを用意
- 追跡/分析: なし（ローカルのみ）

---

## 実装ステップ（v1案）

1. 内蔵JSONのスキーマ確定とサンプル投入
2. 収益計算と収穫計画のコア実装（CLI）
3. ギフト/魚/バンドルの検索API実装
4. セーブファイル読込（任意）: 季節・日付・バンドル進捗の反映
5. データ更新スクリプト（半自動）と出典表示

---

## 環境確認（ゲーム内データ参照の実現性チェック）

可能性: 高い（セーブ読込のみで可）。次の確認で確定:

1. OS とゲームのインストール種別（Steam/GOG）
2. セーブフォルダにアクセス可能か（上記パス）
3. 実サンプルセーブを1つ取得し、XMLの主要ノード（Date/Season、CommunityCenter、FriendshipData 等）を検査
4. もしリアルタイムを希望→SMAPI導入可否の確認

---

## リスク/留意点

- Wiki構造変更によるデータ抽出失敗 → 内蔵JSONの手動更新で回避
- ゲームバージョン差異 → セーブスキーマ差分に注意
- 版権/ライセンス → 出典/クレジットを明記、非商用利用を尊重

---

## 次アクション（要選択）

- A) v1は内蔵JSONでオフライン完結にする（推奨）
- B) 併せてセーブ読込を実装し、季節/バンドル進捗を取り込む
- C) SMAPI連携のPoC（ModでJSONダンプ）を並行検討
